
<!-- Resource Index Section -->
<div class="section">
  <div class="fixed-wrapper">
    <h1><%= RESOURCE_NAME_SINGULAR %> Listing</h1>
    <div  class="col-md-3 col-sm-2 col-xs-12">
      <a href="#" onclick="toggle_visibility('map');">
        <h4 id="map_button" >Hide Map</h4>
      </a>
    </div>
    <div class="col-md-7 col-sm-4 col-xs-12">
      <div class = "simplesearch">
        <%= form_tag resources_path, :method => 'get' do %>          
          <%= text_field_tag :search, params[:search] %>
          <%= submit_tag "Search #{RESOURCE_NAME_PLURAL}  ", :name => nil %>          
          <% if params[:search].present? %>
            <% @resources %>
            <%= link_to "Clear Results", resources_path %>
          <% end %>
        <% end %>
      </div>
      <div class="col-md-2 col-sm-4 col-xs-12">
      </div>
    </div>
  </div>
 
  <div id="map" style='margin-left: 20px;width: 95%; height: 400px;'>
  </div>

  <div class="container">
    <div id="masonry-container" class="resource-wall transitions-enabled infinite-scroll clearfix">
    </div>
  </div>
</div><!-- /.section -->


 <div id="templates">
  <script class="resource" type="text/template">
    <div class="polaroid resource-box">
      <div class="imgContainer imgLiquidFill imgLiquid" style="width:220px; height:220px;">
        <a href="/resources/{{ id }}" >
          <img src={{ picture }} />
        </a>
      </div>
      <div class="info">
        <p class="name"> {{ name }} </p>
        <p class="distance-away"> {{ distance }} miles away</p>
      </div>
    </div>
  </script>
</div>

<% content_for :javascript do %>
  <script type="text/javascript">
    var wall = new ResourceWall([], {
      url: '/resources'
    });
    
    var wallView = new ResourceWallView({
      collection: wall,
      el: '.resource-wall'
    });

    var resourceDistances = <%= raw @jason %>;

    for (var i=0; i < resourceDistances.length; i++) {
       wall.add( resourceDistances[i]);
     }

    $(document).ready(function() {
      $(".imgLiquidFill").imgLiquid({fill:true});

    });
  </script>

  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/trunk/richmarker/src/richmarker-compiled.js' type='text/javascript'></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script>

  <script type="text/javascript">
    buildmap(<%= raw @hash.to_json %>);

    // handler = Gmaps.build('Google');
    // handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    //   markers = handler.addMarkers(<%= raw @hash.to_json %>);
    // handler.bounds.extendWith(markers);
    // handler.fitMapToBounds();
    // handler.getMap().setZoom(17);
    // });
  </script>

  <script type="text/javascript">

    function toggle_visibility(id) {
       var e = document.getElementById(id);
       if(e.style.display == 'block' || e.style.display ==''){
          e.style.display = 'none';
       
        $('#map_button').text("Show Map");
      }
       else {
          e.style.display = 'block'; 
          $('#map_button').text("Hide Map");      
       }
    };

  </script>

<% end %>