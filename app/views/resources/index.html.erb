<style>
/*  *{
    border: 1px solid red;
  }*/
</style>

<head>
  <div class="search affix" style="opacity: 1;">
    <i class="fa fa-search icon"></i>
      <%= form_tag resources_path, class: "form-inline", :method => 'get' do %> 
        <div class="form-group">
          <%= text_field_tag :search, params[:search], class: "form-control" %>
        </div>         
      <% end %>
  </div>
</head>

<div class="section" id="image-list">
  <div class="fixed-wrapper">
    <h1><%= RESOURCE_NAME_SINGULAR %> Listing</h1>
  </div>


<!-- Resource Index Map View -->

  <div class="container index" id="map" style="display:none;">
    <div class="hide-map">
      <a href="#" onclick="toggle_visibility('image-list');">
        <h4 id="map_button" >Show Images View</h4>
      </a>
    </div>
    <% if params[:search].present? %>
      <% @resources %>
    <div class="search-clear" style="display:inline-block; float:right;">
      <span>Showing search results for "<%= params[:search] %>." &nbsp &nbsp</span>
      <%= link_to "Clear Results", resources_path %>
    </div>
    <% end %>
<!--     <div class="hide-map">
      <a href="#" onclick="toggle_visibility('map');">
        <h4 id="map_button" >Hide Map</h4>
      </a>
    </div> -->
    <div style='margin-left: 20px;width: 95%; height: 400px;'>
    </div>
  </div>


<!-- Resource Index By Image -->
  <div class="container index" id="image-list">
    <div class="hide-map">
      <a href="#" onclick="toggle_visibility('map');">
        <h4 id="map_button" >Show Map View</h4>
      </a>
    </div>

    <% if params[:search].present? %>
      <% @resources %>
    <div class="search-clear" style="display:inline-block; float:right;">
      <span>Showing search results for "<%= params[:search] %>." &nbsp &nbsp</span>
      <%= link_to "Clear Results", resources_path %>
    </div>
    <% end %>
<!--     <div class="hide-map">
      <a href="#" onclick="toggle_visibility('map');">
        <h4 id="map_button" >Map View</h4>
      </a>
    </div>
    <div style="margin-left: 20px;width: 95%; height: 400px;">
    </div> -->
    <div id="masonry-container" class="resource-wall transitions-enabled infinite-scroll clearfix">
    </div>
  </div>


</div><!-- /.section -->


 <div id="templates">
  <script class="resource" type="text/template">
    <div class="polaroid resource-box">
      <div class="imgContainer imgLiquidFill imgLiquid" style="width:220px; height:220px;">
        <a href="/resources/{{ id }}" >
          <img src={{ picture }} />
        </a>
      </div>
      <div class="info">
        <p class="name"> {{ name }} </p>
        <p class="distance-away"> {{ distance }} miles away</p>
      </div>
    </div>
  </script>
</div>

<% content_for :javascript do %>
  <script type="text/javascript">
    var wall = new ResourceWall([], {
      url: '/resources'
    });
    
    var wallView = new ResourceWallView({
      collection: wall,
      el: '.resource-wall'
    });

    var resourceDistances = <%= raw @jason %>;

    for (var i=0; i < resourceDistances.length; i++) {
       wall.add( resourceDistances[i]);
     }

    $(document).ready(function() {
      $(".imgLiquidFill").imgLiquid({fill:true});

    });
  </script>

  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/trunk/richmarker/src/richmarker-compiled.js' type='text/javascript'></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script>

  <script type="text/javascript">
    buildmap(<%= raw @hash.to_json %>);

    // handler = Gmaps.build('Google');
    // handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    //   markers = handler.addMarkers(<%= raw @hash.to_json %>);
    // handler.bounds.extendWith(markers);
    // handler.fitMapToBounds();
    // handler.getMap().setZoom(17);
    // });
  </script>

  <script type="text/javascript">

    function toggle_visibility(id) {
       var e = document.getElementById(id);
       if(e.style.display == 'none' || e.style.display ==''){
          e.style.display = 'block';
       
        $('#map_button').text("Show other view");
      }
       else {
          e.style.display = 'none'; 
          $('#map_button').text("Show other view");      
       }
    };

  </script>

<% end %>